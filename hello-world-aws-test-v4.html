<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Evidence - Hello World Test v4 (開発者ツール方式)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; margin: -30px -30px 30px -30px; border-radius: 8px 8px 0 0; }
        .step { margin: 20px 0; padding: 20px; border-left: 4px solid #007bff; background-color: #f8f9ff; }
        .code-block { background-color: #f8f9fa; padding: 20px; border-radius: 5px; border: 1px solid #e9ecef; font-family: 'Consolas', 'Monaco', monospace; font-size: 14px; line-height: 1.6; overflow-x: auto; }
        .copy-button { background-color: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 10px 0; }
        .copy-button:hover { background-color: #0056b3; }
        .success { background-color: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .warning { background-color: #fff3cd; color: #856404; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .info { background-color: #d1ecf1; color: #0c5460; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .feature { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; border: 1px solid #ddd; }
        img { max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 AWS Evidence System - Hello World Test v4</h1>
            <p><strong>開発者ツール方式：100%安全・XSS警告なし</strong></p>
        </div>
        
        <div class="success">
            <h3>✅ この方式の利点:</h3>
            <ul>
                <li><strong>セキュリティ警告なし</strong> - XSS攻撃と判定されない</li>
                <li><strong>企業環境対応</strong> - 特別なソフトウェア不要</li>
                <li><strong>確実な動作</strong> - AWSコンソールの認証を直接利用</li>
                <li><strong>権限継承</strong> - ログイン済みユーザーの権限をそのまま使用</li>
            </ul>
        </div>

        <div class="step">
            <h3>🎯 ステップ1: AWSコンソールを開く</h3>
            <p>まず、AWS Management Console にログインしてください：</p>
            <p><a href="https://console.aws.amazon.com" target="_blank">https://console.aws.amazon.com</a></p>
        </div>

        <div class="step">
            <h3>🛠️ ステップ2: 開発者ツールを開く</h3>
            <p>AWSコンソールのページで以下のいずれかの方法で開発者ツールを開きます：</p>
            <ul>
                <li><strong>キーボード:</strong> F12 キーを押す</li>
                <li><strong>右クリック:</strong> ページを右クリック → 「検証」または「開発者ツール」</li>
                <li><strong>メニュー:</strong> ブラウザメニュー → その他のツール → 開発者ツール</li>
            </ul>
            <p>開発者ツールが開いたら <strong>「Console」</strong> タブをクリックしてください。</p>
        </div>

        <div class="step">
            <h3>📋 ステップ3: テストコードをコピー＆実行</h3>
            <p>以下のコードをコピーして、開発者ツールのConsoleに貼り付けて Enterキー を押してください：</p>
            
            <button class="copy-button" onclick="copyCode('test-code')">📋 コードをコピー</button>
            
            <div class="code-block" id="test-code">
// AWS Evidence System - Hello World Test
console.log('🚀 AWS Evidence System テスト開始');

// AWS SDK を動的に読み込み
function loadAWSSDK() {
    return new Promise((resolve, reject) => {
        if (typeof AWS !== 'undefined') {
            console.log('✅ AWS SDK が既に読み込まれています');
            resolve();
            return;
        }
        
        const script = document.createElement('script');
        script.src = 'https://sdk.amazonaws.com/js/aws-sdk-2.1542.0.min.js';
        script.onload = () => {
            console.log('✅ AWS SDK を読み込みました');
            resolve();
        };
        script.onerror = reject;
        document.head.appendChild(script);
    });
}

// メイン実行関数
async function runAWSTest() {
    try {
        console.log('📡 AWS SDK を読み込み中...');
        await loadAWSSDK();
        
        // リージョン設定
        AWS.config.region = 'ap-northeast-1';
        console.log('🌍 リージョンを ap-northeast-1 に設定');
        
        // STS（Security Token Service）で認証情報確認
        console.log('🔐 認証情報を確認中...');
        const sts = new AWS.STS();
        
        sts.getCallerIdentity((err, data) => {
            if (err) {
                console.error('❌ 認証エラー:', err);
            } else {
                console.log('✅ 認証成功！');
                console.log('📋 ユーザー情報:');
                console.log(`   Account: ${data.Account}`);
                console.log(`   ARN: ${data.Arn}`);
                console.log(`   User ID: ${data.UserId}`);
                
                // S3バケット一覧も取得してみる
                testS3Access();
            }
        });
        
    } catch (error) {
        console.error('❌ エラーが発生しました:', error);
    }
}

// S3アクセステスト
function testS3Access() {
    console.log('🪣 S3バケット一覧を取得中...');
    const s3 = new AWS.S3();
    
    s3.listBuckets((err, data) => {
        if (err) {
            console.error('❌ S3アクセスエラー:', err);
        } else {
            console.log(`✅ S3バケット一覧取得成功！ (${data.Buckets.length}個のバケット)`);
            if (data.Buckets.length > 0) {
                console.log('📋 バケット一覧:');
                data.Buckets.forEach((bucket, index) => {
                    console.log(`   ${index + 1}. ${bucket.Name} (作成日: ${bucket.CreationDate})`);
                });
            } else {
                console.log('   (バケットが存在しません)');
            }
            
            console.log('🎉 Hello World テスト完了！');
        }
    });
}

// テスト実行
runAWSTest();
            </div>
        </div>

        <div class="step">
            <h3>🔍 ステップ4: 結果を確認</h3>
            <p>Consoleに以下のような出力が表示されれば成功です：</p>
            <div class="feature">
                <ul>
                    <li>✅ AWS SDK を読み込みました</li>
                    <li>🌍 リージョンを ap-northeast-1 に設定</li>
                    <li>✅ 認証成功！</li>
                    <li>📋 ユーザー情報: Account, ARN, User ID</li>
                    <li>✅ S3バケット一覧取得成功！</li>
                    <li>🎉 Hello World テスト完了！</li>
                </ul>
            </div>
        </div>

        <div class="info">
            <h3>📝 高度なテスト（オプション）:</h3>
            <p>基本テストが成功したら、以下の発展的なコードも試せます：</p>
            
            <button class="copy-button" onclick="copyCode('advanced-code')">📋 高度なテストコードをコピー</button>
            
            <div class="code-block" id="advanced-code">
// 高度なAWSサービステスト
async function runAdvancedTests() {
    console.log('🧪 高度なテストを開始');
    
    // CloudWatch Logs のロググループ一覧
    console.log('📊 CloudWatch Logs グループ一覧を取得中...');
    const cloudwatchLogs = new AWS.CloudWatchLogs();
    
    cloudwatchLogs.describeLogGroups({ limit: 10 }, (err, data) => {
        if (err) {
            console.log('⚠️ CloudWatch Logs アクセス権限なし:', err.message);
        } else {
            console.log(`✅ CloudWatch Logs: ${data.logGroups.length}個のログループ`);
            data.logGroups.forEach(group => {
                console.log(`   📁 ${group.logGroupName}`);
            });
        }
    });
    
    // Step Functions の状態マシン一覧
    console.log('🔄 Step Functions 状態マシン一覧を取得中...');
    const stepfunctions = new AWS.StepFunctions();
    
    stepfunctions.listStateMachines({}, (err, data) => {
        if (err) {
            console.log('⚠️ Step Functions アクセス権限なし:', err.message);
        } else {
            console.log(`✅ Step Functions: ${data.stateMachines.length}個の状態マシン`);
            data.stateMachines.forEach(machine => {
                console.log(`   ⚙️ ${machine.name} (${machine.type})`);
            });
        }
    });
    
    // Lambda 関数一覧
    console.log('⚡ Lambda 関数一覧を取得中...');
    const lambda = new AWS.Lambda();
    
    lambda.listFunctions({ MaxItems: 10 }, (err, data) => {
        if (err) {
            console.log('⚠️ Lambda アクセス権限なし:', err.message);
        } else {
            console.log(`✅ Lambda: ${data.Functions.length}個の関数`);
            data.Functions.forEach(func => {
                console.log(`   ⚡ ${func.FunctionName} (${func.Runtime})`);
            });
        }
    });
    
    console.log('🎯 高度なテスト完了！');
}

// 高度なテスト実行
runAdvancedTests();
            </div>
        </div>

        <div class="warning">
            <h3>⚠️ トラブルシューティング:</h3>
            <ul>
                <li><strong>「Access Denied」エラー:</strong> 正常です。該当サービスへのアクセス権限がないだけ</li>
                <li><strong>「Network Error」:</strong> インターネット接続を確認</li>
                <li><strong>「AWS is not defined」:</strong> SDK読み込み失敗、しばらく待ってから再実行</li>
                <li><strong>認証エラー:</strong> AWSコンソールに正しくログインしているか確認</li>
            </ul>
        </div>

        <div class="success">
            <h3>🎉 次のステップ:</h3>
            <p>Hello Worldテストが成功したら、本格的なエビデンス収集システムの開発に進むことができます！</p>
            <ul>
                <li>Step Functions実行履歴の自動取得</li>
                <li>CloudWatchログの一括ダウンロード</li>
                <li>S3とRedshiftのデータ比較</li>
                <li>HTMLレポートの自動生成</li>
            </ul>
        </div>
    </div>

    <script>
        function copyCode(elementId) {
            const codeElement = document.getElementById(elementId);
            const text = codeElement.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = '✅ コピーしました！';
                button.style.backgroundColor = '#28a745';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.backgroundColor = '#007bff';
                }, 2000);
            }).catch(() => {
                alert('手動でコードを選択してコピーしてください');
            });
        }
    </script>
</body>
</html>