<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Evidence - Console Script Injection</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; margin: -30px -30px 30px -30px; border-radius: 8px 8px 0 0; }
        .code-block { background-color: #2d3748; color: #e2e8f0; padding: 20px; border-radius: 5px; font-family: 'Consolas', 'Monaco', monospace; font-size: 14px; line-height: 1.6; overflow-x: auto; }
        .copy-button { background-color: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 10px 0; }
        .copy-button:hover { background-color: #0056b3; }
        .success { background-color: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .warning { background-color: #fff3cd; color: #856404; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .step { margin: 20px 0; padding: 20px; border-left: 4px solid #007bff; background-color: #f8f9ff; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ AWS Evidence - Console Script Injection</h1>
            <p><strong>CORSå›é¿ç‰ˆï¼šAWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«å†…å®Ÿè¡Œ</strong></p>
        </div>
        
        <div class="warning">
            <h3>âš ï¸ CORSå•é¡Œã«ã¤ã„ã¦:</h3>
            <p>AWS APIã‚’å¤–éƒ¨ã‚µã‚¤ãƒˆã‹ã‚‰ç›´æ¥å‘¼ã³å‡ºã™ã¨CORSã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚<br>
            ã“ã‚Œã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šæ­£å¸¸ãªå‹•ä½œã§ã™ã€‚</p>
        </div>

        <div class="success">
            <h3>âœ… ã“ã®æ–¹æ³•ã®åˆ©ç‚¹:</h3>
            <ul>
                <li><strong>CORSã‚¨ãƒ©ãƒ¼ãªã—</strong> - AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«å†…ã§å®Ÿè¡Œ</li>
                <li><strong>èªè¨¼è‡ªå‹•</strong> - ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ©ç”¨</li>
                <li><strong>åˆ¶é™ãªã—</strong> - ä¼æ¥­ç’°å¢ƒã§ã‚‚ç¢ºå®Ÿã«å‹•ä½œ</li>
            </ul>
        </div>

        <div class="step">
            <h3>ğŸ¯ æ‰‹é †1: AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ã</h3>
            <p><a href="https://console.aws.amazon.com/console/home" target="_blank">AWS Management Console</a> ã‚’é–‹ã„ã¦ãã ã•ã„</p>
        </div>

        <div class="step">
            <h3>ğŸ”§ æ‰‹é †2: é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ</h3>
            <p>AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã§ F12 â†’ Console ã‚¿ãƒ– â†’ ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œ</p>
            
            <button class="copy-button" onclick="copyCode('console-test')">ğŸ“‹ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å†…å®Ÿè¡Œã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>
            
            <div class="code-block" id="console-test">
console.log('=== AWS Console Script Injection Test ===');

function testAWSConsoleAccess() {
    console.log('Testing AWS Console JavaScript access...');
    
    console.log('Current URL:', window.location.href);
    console.log('Domain:', window.location.hostname);
    
    if (window.location.hostname.includes('console.aws.amazon.com')) {
        console.log('âœ… Running on AWS Console - Perfect!');
        
        console.log('Checking for AWS global objects...');
        console.log('window.AWS:', typeof window.AWS);
        console.log('window.awsConfig:', typeof window.awsConfig);
        console.log('window.region:', window.region || 'undefined');
        
        if (window.localStorage) {
            const awsKeys = Object.keys(window.localStorage).filter(key => 
                key.toLowerCase().includes('aws') || 
                key.toLowerCase().includes('credential') ||
                key.toLowerCase().includes('token')
            );
            console.log('AWS-related localStorage keys:', awsKeys);
        }
        
        if (window.sessionStorage) {
            const awsSessionKeys = Object.keys(window.sessionStorage).filter(key => 
                key.toLowerCase().includes('aws') || 
                key.toLowerCase().includes('credential') ||
                key.toLowerCase().includes('token')
            );
            console.log('AWS-related sessionStorage keys:', awsSessionKeys);
        }
        
        console.log('Checking document cookies...');
        const cookies = document.cookie.split(';').filter(cookie => 
            cookie.toLowerCase().includes('aws') ||
            cookie.toLowerCase().includes('session') ||
            cookie.toLowerCase().includes('auth')
        );
        console.log(`Found ${cookies.length} AWS-related cookies`);
        
        testNetworkRequests();
    } else {
        console.log('âŒ Not running on AWS Console');
        console.log('Please run this script on console.aws.amazon.com');
    }
}

function testNetworkRequests() {
    console.log('\n=== Testing Network Requests ===');
    
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
        console.log('Intercepted fetch request:', args[0]);
        return originalFetch.apply(this, args);
    };
    
    const originalXHR = window.XMLHttpRequest;
    const origOpen = originalXHR.prototype.open;
    originalXHR.prototype.open = function(method, url) {
        console.log('Intercepted XHR request:', method, url);
        origOpen.apply(this, arguments);
    };
    
    console.log('Network interception enabled');
    console.log('Now try using AWS services in the console...');
    
    setTimeout(() => {
        window.fetch = originalFetch;
        originalXHR.prototype.open = origOpen;
        console.log('Network interception disabled');
    }, 30000);
}

testAWSConsoleAccess();
            </div>
        </div>

        <div class="step">
            <h3>ğŸ” æ‰‹é †3: AWS APIç›´æ¥ãƒ†ã‚¹ãƒˆ</h3>
            <p>ä¸Šè¨˜ãƒ†ã‚¹ãƒˆã§æƒ…å ±ã‚’ç¢ºèªå¾Œã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§AWS APIã‚’ç›´æ¥ãƒ†ã‚¹ãƒˆï¼š</p>
            
            <button class="copy-button" onclick="copyCode('api-test')">ğŸ“‹ APIç›´æ¥ãƒ†ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
            
            <div class="code-block" id="api-test">
console.log('=== Direct AWS API Test from Console ===');

async function testDirectAPI() {
    try {
        console.log('Testing from AWS Console context...');
        
        const response = await fetch('/api/sts/GetCallerIdentity', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-amz-json-1.1',
                'X-Amz-Target': 'AWSSecurityTokenServiceV20110615.GetCallerIdentity'
            },
            credentials: 'same-origin'
        });
        
        console.log('Response status:', response.status);
        const data = await response.json();
        console.log('Response data:', data);
        
    } catch (error) {
        console.log('Direct API failed, trying alternative...');
        
        try {
            const proxyResponse = await fetch(window.location.origin + '/api/proxy', {
                method: 'POST',
                body: JSON.stringify({
                    service: 'sts',
                    action: 'GetCallerIdentity'
                }),
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'same-origin'
            });
            
            console.log('Proxy response:', proxyResponse.status);
            const proxyData = await proxyResponse.text();
            console.log('Proxy data:', proxyData);
            
        } catch (proxyError) {
            console.error('Both direct and proxy failed:', proxyError);
            console.log('Try manual AWS service navigation and check network tab');
        }
    }
}

testDirectAPI();
            </div>
        </div>

        <div class="step">
            <h3>ğŸ“Š æ‰‹é †4: å®Ÿè·µçš„ãªãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ</h3>
            <p>AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«å†…ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’å®Ÿéš›ã«æ“ä½œã—ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’ç¢ºèªï¼š</p>
            
            <button class="copy-button" onclick="copyCode('practical-test')">ğŸ“‹ å®Ÿè·µãƒ†ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
            
            <div class="code-block" id="practical-test">
console.log('=== Practical AWS Data Extraction ===');

function setupNetworkMonitoring() {
    const observer = new PerformanceObserver((list) => {
        list.getEntries().forEach((entry) => {
            if (entry.name.includes('amazonaws.com') || 
                entry.name.includes('/api/') ||
                entry.name.includes('sts') ||
                entry.name.includes('s3')) {
                console.log('AWS API Call detected:');
                console.log('URL:', entry.name);
                console.log('Duration:', entry.duration);
                console.log('Type:', entry.entryType);
            }
        });
    });
    
    observer.observe({ entryTypes: ['resource', 'navigation'] });
    
    console.log('Network monitoring active');
    console.log('Now navigate to AWS services (S3, EC2, etc.) in the console');
    console.log('API calls will be logged here');
    
    return observer;
}

const monitor = setupNetworkMonitoring();

console.log('To stop monitoring, run: monitor.disconnect()');
            </div>
        </div>

        <div class="warning">
            <h3>âš ï¸ é‡è¦:</h3>
            <ul>
                <li>ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯<strong>AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«å†…ã§ã®ã¿</strong>å®Ÿè¡Œã—ã¦ãã ã•ã„</li>
                <li>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§AWS APIã‚³ãƒ¼ãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¢ºèªã§ãã¾ã™</li>
                <li>å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã¯æ‰‹å‹•ã§AWSã‚µãƒ¼ãƒ“ã‚¹ã‚’æ“ä½œã—ãŸéš›ã«å–å¾—ã•ã‚Œã¾ã™</li>
            </ul>
        </div>
    </div>

    <script>
        function copyCode(elementId) {
            const codeElement = document.getElementById(elementId);
            const text = codeElement.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = 'âœ… ã‚³ãƒ”ãƒ¼å®Œäº†!';
                button.style.backgroundColor = '#28a745';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.backgroundColor = '#007bff';
                }, 2000);
            }).catch(() => {
                alert('æ‰‹å‹•ã§ã‚³ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„');
            });
        }
    </script>
</body>
</html>